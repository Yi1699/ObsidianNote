
### 2.1、ARM是RISC机，请说明体系结构方面的RISC特点
指令：选取使用频率高的指令、定长+寻址方式规整、只有存数和取数两条存储器访问指令LOAD/STORE
流水线：使用流水线技术，提高运行效率，减少指令运行周期
通用寄存器：设计多个通用寄存器。

### 2.2、ARM9使用ARM/THUMB两种指令集的目的是什么？为此要解决什么问题，解决思路是什么？
ARM指令集为32位，可以提供更高的执行效率和更丰富的指令功能。而THUMB指令集为16位，指令长度小，代码密度更高，


### 6.1 S3C2440的GPIO是什么？如何使用？
GPIO是一种通用I/O接口，内部有端口，对外有一组引脚，可输入输出高低电平，实现结构简单的外设和电路的控制，该芯片共有117个多功能引脚，分为独立的8组GPIO，每个I/O端口均是多功能（复用）的。
使用：通过对应的控制寄存器GPXCON进行设置，若某个引脚不用于特定功能，则可以设置为普通的输入输出引脚。设置上拉寄存器GPXUP，决定是否使用上拉电阻。配置数据寄存器GPXDAT，设置数据寄存器对应位的值（输入时读取数据，输出时写入数据送到对应引脚上）。
eg：GPIO控制LED
![[Pasted image 20240617102040.png|400]]
```c
// 定义相关寄存器地址
#define rGPFCON    (*(volatile unsigned *)0x56000050)               //端口F的控制寄存器
#define rGPFDAT    (*(volatile unsigned *)0x56000054)              //端口F的数据寄存器
#define rGPFUP       (*(volatile unsigned *)0x56000058)              //端口F的上拉控制寄存器
// 端口初始化
void port_init(void)
{
 //=== PORT F GROUP
 //端口:  GPF7  GPF6  GPF5   GPF4    GPF3     GPF2     GPF1     GPF0
 //信号:  LED1  LED2  LED3   LED4 PS2_INT CPLD_INT1  KEY_INT BUT_INT1
 //设置属性: Output Output Output Output  EINT3  EINT2   EINT1  EINT0
 //二进制值: 01       01,    01      01,      10      10,      10，     10
    rGPFCON = 0x55aa;  // 0101 0101 1010 1010
    rGPFUP  = 0xff;     // GPF所有端口不上拉，电流输入
}
// 开启LED
void led_on(void){
    int i, nOut; 
    nOut=0xF0;                    //全灭，低4位的写入无意义
    rGPFDAT=nOut & 0x70;   //点亮LED1
    for(i=0;i<100000;i++);  //延时
    rGPFDAT=nOut & 0x30;   //点亮LED1 LED2
    for(i=0;i<100000;i++);
    rGPFDAT=nOut & 0x10;   //点亮LED1 LED2 LED3
    for(i=0;i<100000;i++);
    rGPFDAT=nOut & 0x00;   //点亮LED1 LED2 LED3 LED4
    for(i=0;i<100000;i++);
}
// 关闭LED
void led_off(void){
    int i,nOut;
    nOut=0;
    rGPFDAT = 0;                  //全亮
    for(i=0;i<100000;i++);
    rGPFDAT = nOut | 0x80;   //关闭LED1
    for(i=0;i<100000;i++);
    rGPFDAT |= nOut | 0x40; //关闭LED2
    for(i=0;i<100000;i++);
    rGPFDAT |= nOut | 0x20; //关闭LED3
    for(i=0;i<100000;i++);
    rGPFDAT |= nOut | 0x10; //关闭LED4
    for(i=0;i<100000;i++);
}
// 所有LED交替亮灭
void led_on_off(void)
{
    int i;
    rGPFDAT=0;               //所有LED全亮
    for(i=0;i<100000;i++);
    rGPFDAT=0xF0;           //所有LED全灭
    for(i=0;i<100000;i++);
}
```
### 6.2 S3C2440的UART是什么？如何使用？
UART，即通用异步收发器，是一种采用异步串行、全双工通信方式的通信协议。


### 6.3、S3C2440的Watchdog是什么？如何使用？
是一种带有**中断请求的定时器**电路，用于提高可靠性，防止系统由于受到干扰而产生的“死机”现象，导致系统复位等。
使用方法：系统正常时不断“喂狗”，使定时器不会溢出；在系统异常时，导致**定时器超时**，产生一个有128PCLK个时钟周期的**系统复位信号及中断请求信号**。使用中，需要设置看门狗控制寄存器，设置时钟源，配置分频器，设置超时值，不断“喂狗”，并配置触发行为。

### 6.4、SWI中断程序的处理流程及代码
处理流程：
	中断程序处理流程
		1. 程序通过SWI指令触发中断。
		2. 处理器将当前程序状态（包括程序计数器PC、寄存器等）保存到内存中，以便中断处理程序执行完毕后恢复程序状态。
		3. 处理器跳到中断处理程序的入口地址，并将中断号传递给处理程序。
		4. 中断处理程序根据中断号执行相应的操作，例如进行系统调用、处理异常等。
		5. 中断处理程序执行完毕后，处理器从内存中恢复保存的程序状态，包括程序计数器%20PC、寄存器等。
		6. 处理器返回到被中断的程序，并从中断指令的下一条指令继续执行。
	响应过程：
		自动保存CPSR到管理模式的SPSR中
		通过指令关闭中断
		自动保存返回地址
		自动转移到SWI向量
	返回：
		MOV PC, LR
代码：
```
HandlerSWI	;SWI中断服务程序
	STMFD SP！ ,{R0-R5,R14};保存现场
	LDR R0,[LR,#-4];取SWI指令(假设ARM态)
	BICR0,R0,#0xFF000000 ;取低24位
	……
	DMIA  SP！ ,{R0-R5,R14};恢复现场MOV PC,LR;中断返回
```
### 6.5、包括外部中断服务程序的程序框架
```
中断向量表
复位异常处理程序：…，关于外部中断的部分
外部中断服务程序
    查询32路中断，设置32路中断散转表
    每个散转程序进一步查询，并处理
```

### 6 例题
```c
//关于GPIO组F（8位的输入/输出端口）的使用，有以下代码：
#define rGPFCON    (*(volatile unsigned *)0x56000050)   //GPIO组F的控制寄存器  1
#define rGPFDAT    (*(volatile unsigned *)0x56000054)   //GPIO组F的数据寄存器
#define rGPFUP      (*(volatile unsigned *)0x56000058)  //GPIO组F的上拉寄存器
void port_init(void) {
    rGPFCON = 0x5555;  //2
    rGPFUP  = 0xff;     // 不上拉
}
void func(void) {
	int i, j, nOut=0xFF;    
	for (i=0;i<1000;i++) {
		rGPFDAT=nOut & 0xF0;   
		for(j=0;j<100000;j++);  //延时
		rGPFDAT=nOut
		for(j=0;j<100000;j++); }
}
```
![[Pasted image 20240617164826.png|400]]
（1）GPIO是什么？
见上文
（2）语句①将rGPFCON定义为“(\*(volatile unsigned \*)0x56000050)”，解释其含义，特别要先说明“volatile”、“unsigned”和两个“\*”的含义是什么? 
unsigned说明是无符号数，volatile修饰说明关闭编译器优化，使每次在使用这个变量的值的时候都重新读取数据，而不是从寄存器中取出备份。volatile unsigned\*是无符号指针，表示对该地址进行强制类型转换，而前面加上\*符号是指针的解引用，整个定义表示将该地址的值取出放入寄存器中，并且不会对读取操作进行优化。
（3）写出语句②的作用是什么？如果改为汇编代码，应该怎么写？ 
语句2表示将8个GPIO引脚全部设置为输出引脚，改为汇编代码，写法如下：
```c
LDR RO, =0x56000050
LDR R1, =0x5555
STM R1, [R0]
```
（4）函数func的作用是什么？ 
GPIO低4位引脚周期输出高低电平，可作为其他期间的时钟信号。
（5）总结S3C2440中GPIO的一般使用方法。
	1. 设置寄存器地址，即定义相关寄存器。
	2. 通过对应的控制寄存器GPXCON进行设置，若某个引脚不用于特定功能，则可以设置为普通的输入输出引脚。设置上拉寄存器GPXUP，决定是否使用上拉电阻。
	3. 配置数据寄存器GPXDAT，设置数据寄存器对应位的值（输入时读取数据，输出时写入数据送到对应引脚上）来控制对应端口的输入输出状态。
