 
#### 概念
◼ 计算机图形学
◼ 研究真实或者虚拟世界的图形表示以及人-机交互，是涉及计算
机、数学、物理等学科的交叉领域。
◼ 建模、 绘制和交互是计算机图形学的主要内容

#### 渲染管线
就是一堆原始图形数据经过各种变化处理最终出现在屏幕的过程。渲染管线可分为三个阶段，应用程序阶段，几何阶段，和光栅化阶段。
1. 应用程序阶段由CPU主要负责。CPU将GPU渲染需要的灯光、模型准备好，并设置好渲染状态，为GPU渲染做好准备。
2. 几何阶段把输入的3D数据转换成2D数据(将3D模型投影变换到图像平面)。包括顶点着色器(进行坐标变换)、裁剪和屏幕映射几个过程。
3. 光栅化阶段把图元映射为最终屏幕上显示的颜色。包括光栅化，片段着色，深度测试和混合。

坐标系：物体坐标系（几何变换）-> 世界坐标系（视点变换）->相机坐标系（投影变换）->图像坐标系
几何变换：顺序不同效果不同，为了平移可用矩阵表示，采用齐次坐标，三维中点（x,y,z,1）向量（x,y,z,0）变换时矩阵左乘至原先结果。
欧拉角表示：存在万向锁问题，实验使用zyx泰特布莱恩角

封闭多边形的内外：射线奇偶检测法、扫描线转化

MipMap解决远距离的贴图走样，存储分级细化纹理

----
#### 真实感绘制：局部技术和全局技术

#### 抗锯齿
光栅化的时候，是以像素中心点是否被三角形覆盖来决定是否生成片段，因此有些片段覆盖了采样点就生成，有些没有覆盖就不生成，最终导致了锯齿现象。

1. 超采样抗锯齿(SSAA)
先映射到高分辨率缓存中放大，然后对每个图像像素进行采样，一般取临近2-4个像素，采样混合后，生成最终的像素再缩小还原为原来图像一样的大小

2. 多重采样抗锯齿(MSAA)
请问FXAA、FSAA与MSAA有什么区别？效果和性能上哪个好？ - 知乎 (zhihu.com)

（1）基本概念
在光栅化阶段，判断三角形是否被像素覆盖时，会计算多个采样点，然后计算一个覆盖率；在片段着色阶段，每个像素仍然只计算一次颜色值，片段以像素中央来进行计算，只是最后的结果会乘上一个覆盖率；MSAA的高效性在于，他没有每个采样点都计算一次着色，而是每个像素只计算一次着色，最后乘上一个覆盖率；

（2）MSAA的缺点，以及为什么？
MSAA对延迟渲染的支持不是很好；有三个原因，一个是MSAA本质上是一种发生在光栅化阶段的技术，也就是几何阶段后，着色阶段前，这个技术需要用到场景中的几何信息，但是延迟渲染因为需要节省光照计算的原因，事先把所有信息都放在了GBuffer上，着色计算的时候已经丢失了几何信息；而且关键一点是如果强行这么做，MSAA会增加数倍的带宽性能消耗，因此一般都不会这么做。还有一个原因是是以前DX9的时代，MRT(多重渲染目标)技术不支持MSAA。

3. 快速近似抗锯齿(FXAA)
FXAA（Fast Approximate Anti-Aliasing），快速近似抗锯齿处理，是MSAA一种高性能近似；它位于后处理阶段实现，不依赖于硬件；总体思想是：a. 找出图像中的所有边缘（通过亮度比较，G分量）；b.平滑化边缘（沿着某个方向将一定范围的像素取出来加权平均）。

4. 时域抗锯齿(TAA)
从时间维度上进行抗锯齿处理，使用同个像素在不同帧上的不同采样点，根据时间先后进行一个加权平均计算；但是TAA也有缺点，就是容易出现鬼影和抖动的现象；

5. 深度学习超采样(DLSS)
DLSS 2.0可以在不损失画质的情况下，通过人工智能 /深度学习，直接把游戏实时渲染的结果实现四倍超采样。

#### 三种光照类型：

「高光」：物体完全反射光源照射到表面的光照到人眼
「漫反射光」：物体朝着任意方向反射相同亮度的光照到人眼
「环境光」：物体表面完全背对光源，但其它物体反射光照照射到该物体表面上，再通过该物体反射光照到人眼
#### Blinn-Phong反射模型
使用四个向量描述曲面上p点的光
照效果：
- 曲面法向量n
- 视线方向v
- 入射方向L
- 反射方向r

##### 漫反射光
漫反射光是物体表面向四面八方反射相同强度的能量，所以：无论从哪个视角看同一个点，都应该呈现出相同的颜色。
Ld = Kd * (I / (r * r)) * max(0, n * l)
Kd为吸收率，用RGB值表示
###### 朗伯余弦定律
物体表面接收到光的能量与法线方向、光照方向两者夹角的余弦值成正比关系。(越垂直，接收到能量越大)    cos a = n * l
我们可以将光看作是光子的集合，在空间中按特定的方向传播。每个光子都载有能量。光源每秒发出的能量称为辐射通量（radiant flux）。它主要用来确定表面区域所接收的光量。某区域内的辐射通量密度（irradiance 辐照度）是计算光照很重要的概念。

传播光衰减：I' = I / (r * r)
##### 环境光
假设环境光处处相等，用于模拟全局光照效果
La = Ka * Ia，Ka为环境光吸收率

##### 高光
观察角度与光反射角度越接近，高光越明显
Phong模型高光计算：计算反射向量与观察向量的夹角，当观察向量与反射向量夹角大于90度，可能出现光照不连续情况。
Blinn-Phong模型计算：半程向量与法线夹角
Ls = Ks * (I / (r * r)) * pow(max(0, n * h), p)

最终为三种光叠加，再对所有光源叠加
#### 着色
均匀着色、光滑着色（Gouraud shading）、Phong shading
G：顶点使用面法向取平均得到并计算颜色，面内各点通过顶点颜色进行插值。
P：插值计算各点法向，用光照模型计算每点颜色

#### 阴影
###### 静态阴影
平面阴影：齐次变换矩阵
阴影纹理：不能在自己身上投影
###### 立体阴影
给定光源和投射阴影的物体，每个投射阴影的三角形产生一个阴影体，判断某一点是否在阴影体内
###### 阴影贴图
从光源的角度使用Z-buffer，检查Va和Vb到light的距离是否大于shadow
map中的值，有阴影失真问题

#### BRDF（双向反射分布函数）
描述了入射光线经过某个表面反射后如何在各个出射方向上分布
#### PBR（基于物理的渲染）

---
## 问答
### 讲讲渲染流程
渲染管线共四个阶段
第一个是应用程序阶段，在这个阶段由CPU进行渲染前的准备，CPU向GPU输送数据，如场景灯光、模型顶点数据、相机位置数据、视椎体数据等。这个阶段还会进行渲染状态的设置，比如设置渲染使用的材质、纹理、着色器类型等等。该阶段还会进行一些剔除，除去不需要渲染的元素，减少不必要的渲染工作。

几何阶段：这个阶段在GPU进行，主要对片元进行一些处理工作，按照顺序来说，主要有顶点着色器、曲面细分着色器、几何着色器，然后会进行裁剪，然后进行屏幕映射。顶点着色器主要对顶点进行操作，这一步是必要的过程，并且是可编程的，主要功能是对顶点进行坐标变换，将物体坐标从世界坐标系到裁剪坐标系（展开讲坐标变换：模型变换、相机变换、透视投影变换、视口变换），有些渲染算法在顶点着色器会计算顶点的颜色；传统的裁剪主要由硬件实现，将相机看不见的顶点、物体剔除；屏幕映射：这一步输入的坐标仍是三维坐标（范围在单位立方体内），屏幕映射的任务就是将每个图元的x、y值变换到屏幕坐标系（屏幕坐标系是一个2D空间）。由于输入坐标范围在[ -1, 1 ]，因此这是一个拉伸到屏幕分辨率大小的过程。对于输入的坐标z值不做任何处理（实际上屏幕坐标系和z坐标一起构成窗口坐标系），这些值会被一起传递到光栅化阶段。

光栅化阶段：这个阶段同样在GPU进行，主要决定渲染图元中哪部分被绘制在平面上，通过对每个数据进行插值，然后每个像素处理。光栅化第一个阶段是图元组装，就是把一个个顶点进行连接组合成一个个的基本图形比如三角形，
片元遍历，对每个片元，